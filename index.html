<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Registro de colaboradores</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://cdn.jsdelivr.net/npm/jwt-decode/build/jwt-decode.min.js"></script>
</head>
<body>
  <h2>Formulario de Registro</h2>

  <!-- Google Sign-In -->
  <div id="googleSignIn" class="g_id_signin"
       data-client_id="TU_CLIENT_ID_GOOGLE"
       data-callback="handleCredentialResponse"
       data-auto_prompt="false">
  </div>

  <p id="usuarioLogueado"></p>

  <!-- Formulario -->
  <form id="formularioRegistro">
    <label for="correo">Correo:</label><br>
    <input type="email" id="correo" name="entry.12345" readonly><br><br>

    <label for="nombre">Nombre:</label><br>
    <input type="text" id="nombre" name="entry.17282" readonly><br><br>

    <label for="proceso">Proceso:</label><br>
    <input type="text" id="proceso" name="entry.18784" readonly><br><br>

    <label for="ubicacion">Ubicación:</label><br>
    <input type="text" id="ubicacion" name="entry.54321" readonly><br><br>

    <label for="tipoUsuario">Tipo de registro:</label><br>
    <select id="tipoUsuario" name="entry.99999" required>
      <option value="">-- Selecciona --</option>
      <option value="Ingreso">Ingreso</option>
      <option value="Salida">Salida</option>
    </select><br><br>

    <button type="submit">Enviar</button>
  </form>

  <script>
    // Diccionario de usuarios
    const usuariosAutorizados = {
      "luis.diaz@personal.com": {
        nombre: "LUIS EDUARDO DIAZ",
        proceso: "Activos"
      },
      "luis.diaz@empresa.com": {
        nombre: "LUIS EDUARDO DIAZ",
        proceso: "Activos"
      },
      "luis.alvarado@empresa.com": {
        nombre: "LUIS EDUARDO ALVARADO",
        proceso: "Activos"
      }
    };

    function handleCredentialResponse(response) {
      const data = jwt_decode(response.credential);
      const correo = data.email;
      const nombreGoogle = data.name;

      document.getElementById("usuarioLogueado").textContent = `Bienvenido, ${nombreGoogle} (${correo})`;
      document.getElementById("googleSignIn").style.display = "none";

      // Validar usuario
      const usuario = usuariosAutorizados[correo];
      if (usuario) {
        // Autocompletar campos
        document.getElementById("correo").value = correo;
        document.getElementById("nombre").value = usuario.nombre;
        document.getElementById("proceso").value = usuario.proceso;

        // Obtener ubicación
        navigator.geolocation.getCurrentPosition(position => {
          const ubicacion = `${position.coords.latitude}, ${position.coords.longitude}`;
          document.getElementById("ubicacion").value = ubicacion;
        });

      } else {
        alert("Correo no autorizado.");
        location.reload();
      }
    }

    // Envío del formulario
    document.getElementById("formularioRegistro").addEventListener("submit", function (e) {
      e.preventDefault();

      const form = e.target;
      const formData = new FormData(form);

      const params = new URLSearchParams();
      for (const pair of formData) {
        params.append(pair[0], pair[1]);
      }

      fetch("https://docs.google.com/forms/d/e/TU_ID_DE_FORMULARIO/formResponse", {
        method: "POST",
        mode: "no-cors",
        body: params
      });

      alert("Registro enviado con éxito");
      form.reset();
      location.reload();
    });
  </script>
</body>
</html>
